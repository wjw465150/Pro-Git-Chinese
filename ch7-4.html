<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Pro Git - Pro Git 7.4 è‡ªå®šä¹‰ Git Git å¼ºåˆ¶ç­–ç•¥å®ä¾‹</title>
    <link rel="stylesheet" href="master.css" tppabs="http://progit.org/stylesheets/master.css" type="text/css" media="screen" charset="utf-8"/>
    <script src="jquery.js" tppabs="http://progit.org/javascripts/jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="jquery.github.js" tppabs="http://progit.org/javascripts/jquery.github.js" type="text/javascript" charset="utf-8"></script>
    <link rel='alternate' type='application/rss+xml' href='http://feeds.feedburner.com/ProGitBook' />
  </head>
  <body>
    <div id='wrapper'>
      <div id='header'>
        <h1>Pro Git</h1>
        <h2>professional version control</h2>
      </div>
      <div id='menu'>
        <ul>
          <li><a href="javascript:if(confirm('http://progit.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/'" tppabs="http://progit.org/">Home</a></li>
          <li><a href="javascript:if(confirm('http://progit.org/book  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book'" tppabs="http://progit.org/book">Book</a></li>
          <li><a href="javascript:if(confirm('http://progit.org/blog.html  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/blog.html'" tppabs="http://progit.org/blog.html">Blog</a></li>
          <li><a href="javascript:if(confirm('http://progit.org/about.html  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/about.html'" tppabs="http://progit.org/about.html">About</a></li>
          <li><a href="javascript:if(confirm('http://progit.org/support.html  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/support.html'" tppabs="http://progit.org/support.html">Support Us</a></li>
          <li><a href="javascript:if(confirm('http://github.com/progit  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://github.com/progit'" tppabs="http://github.com/progit" target='_blank' rel='me'>GitHub</a></li>
          <li><a href="javascript:if(confirm('http://twitter.com/twitter  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://twitter.com/twitter'" tppabs="http://twitter.com/twitter" target='_blank' rel='me'>Twitter</a></li>
        </ul>
      </div>
      <div id="message">
        This is an in-progress translation. <br/>
        To help translate the book, please
        fork the book <a href="javascript:if(confirm('http://github.com/progit/progit  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://github.com/progit/progit'" tppabs="http://github.com/progit/progit">at GitHub</a> and push your contributions.
      </div>
      <div id='content'>
        <h2 id='git_'>Git å¼ºåˆ¶ç­–ç•¥å®ä¾‹</h2>

<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬åº”ç”¨å‰é¢å­¦åˆ°çš„çŸ¥è¯†å»ºç«‹è¿™æ ·ä¸€ä¸ªGit å·¥ä½œæµç¨‹ï¼šæ£€æŸ¥æäº¤ä¿¡æ¯çš„æ ¼å¼ï¼Œåªæ¥å—çº¯fast-forwardå†…å®¹çš„æ¨é€ï¼Œå¹¶ä¸”æŒ‡å®šç”¨æˆ·åªèƒ½ä¿®æ”¹é¡¹ç›®ä¸­çš„ç‰¹å®šå­ç›®å½•ã€‚æˆ‘ä»¬å°†å†™ä¸€ä¸ªå®¢æˆ·ç«¯è§’æœ¬æ¥æç¤ºå¼€å‘äººå‘˜ä»–ä»¬æ¨é€çš„å†…å®¹æ˜¯å¦ä¼šè¢«æ‹’ç»ï¼Œä»¥åŠä¸€ä¸ªæœåŠ¡ç«¯è„šæœ¬æ¥å®é™…æ‰§è¡Œè¿™äº›ç­–ç•¥ã€‚</p>

<p>è¿™äº›è„šæœ¬ä½¿ç”¨ Ruby å†™æˆï¼Œä¸€åŠç”±äºå®ƒæ˜¯ä½œè€…å€¾å‘çš„è„šæœ¬è¯­è¨€ï¼Œå¦å¤–ä½œè€…è§‰å¾—å®ƒæ˜¯æœ€æ¥è¿‘ä¼ªä»£ç çš„è„šæœ¬è¯­è¨€ï¼›å› è€Œå³ä¾¿ä½ ä¸ä½¿ç”¨ Ruby ä¹Ÿèƒ½å¤§è‡´çœ‹æ‡‚ã€‚ä¸è¿‡ä»»ä½•å…¶ä»–è¯­è¨€ä¹Ÿä¸€æ ·é€‚ç”¨ã€‚æ‰€æœ‰ Git è‡ªå¸¦çš„æ ·ä¾‹è„šæœ¬éƒ½æ˜¯ç”¨ Perl æˆ– Bash å†™çš„ã€‚æ‰€ä»¥ä»è¿™äº›è„šæœ¬ä¸­èƒ½æ‰¾åˆ°ç›¸å½“å¤šçš„è¿™ä¸¤ç§è¯­è¨€çš„æŒ‚é’©æ ·ä¾‹ã€‚</p>

<h3 id='id386'>æœåŠ¡ç«¯æŒ‚é’©</h3>

<p>æ‰€æœ‰æœåŠ¡ç«¯çš„å·¥ä½œéƒ½åœ¨hooksï¼ˆæŒ‚é’©ï¼‰ç›®å½•çš„ updateï¼ˆæ›´æ–°ï¼‰è„šæœ¬ä¸­åˆ¶å®šã€‚update è„šæœ¬ä¸ºæ¯ä¸€ä¸ªå¾—åˆ°æ¨é€çš„åˆ†æ”¯è¿è¡Œä¸€æ¬¡ï¼›å®ƒæ¥å—æ¨é€ç›®æ ‡çš„ç´¢å¼•ï¼Œè¯¥åˆ†æ”¯åŸæ¥æŒ‡å‘çš„ä½ç½®ï¼Œä»¥åŠè¢«æ¨é€çš„æ–°å†…å®¹ã€‚å¦‚æœæ¨é€æ˜¯é€šè¿‡ SSH è¿›è¡Œçš„ï¼Œè¿˜å¯ä»¥è·å–å‘å‡ºæ­¤æ¬¡æ“ä½œçš„ç”¨æˆ·ã€‚å¦‚æœè®¾å®šæ‰€æœ‰æ“ä½œéƒ½é€šè¿‡å…¬åŒ™æˆæƒçš„å•ä¸€å¸å·ï¼ˆæ¯”å¦‚ï¼‚gitï¼‚ï¼‰è¿›è¡Œï¼Œå°±æœ‰å¿…è¦é€šè¿‡ä¸€ä¸ª shell åŒ…è£…ä¾æ®å…¬åŒ™æ¥åˆ¤æ–­ç”¨æˆ·çš„èº«ä»½ï¼Œå¹¶ä¸”è®¾å®šç¯å¢ƒå˜é‡æ¥è¡¨ç¤ºè¯¥ç”¨æˆ·çš„èº«ä»½ã€‚ä¸‹é¢å‡è®¾å°è¯•è¿æ¥çš„ç”¨æˆ·å‚¨å­˜åœ¨ <code>$USER</code> ç¯å¢ƒå˜é‡é‡Œï¼Œæˆ‘ä»¬çš„ update è„šæœ¬é¦–å…ˆæœé›†ä¸€åˆ‡éœ€è¦çš„ä¿¡æ¯ï¼š</p>

<pre><code>#!/usr/bin/env ruby

$refname = ARGV[0]
$oldrev  = ARGV[1]
$newrev  = ARGV[2]
$user    = ENV[&#39;USER&#39;]

puts &quot;Enforcing Policies... \n(#{$refname}) (#{$oldrev[0,6]}) (#{$newrev[0,6]})&quot;</code></pre>

<p>æ²¡é”™ï¼Œæˆ‘åœ¨ç”¨å…¨å±€å˜é‡ã€‚åˆ«é„™è§†æˆ‘â€”â€”è¿™æ ·æ¯”è¾ƒåˆ©äºæ¼”ç¤ºè¿‡ç¨‹ã€‚</p>

<h4 id='id387'>æŒ‡å®šç‰¹æ®Šçš„æäº¤ä¿¡æ¯æ ¼å¼</h4>

<p>æˆ‘ä»¬çš„ç¬¬ä¸€é¡¹ä»»åŠ¡æ˜¯æŒ‡å®šæ¯ä¸€æ¡æäº¤ä¿¡æ¯éƒ½å¿…é¡»éµå¾ªæŸç§ç‰¹æ®Šçš„æ ¼å¼ã€‚ä½œä¸ºæ¼”ç¤ºï¼Œå‡å®šæ¯ä¸€æ¡ä¿¡æ¯å¿…é¡»åŒ…å«ä¸€æ¡å½¢ä¼¼ &#8220;ref: 1234&#8221; è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æŠŠæ¯ä¸€æ¬¡æäº¤å’Œé¡¹ç›®çš„é—®é¢˜è¿½è¸ªç³»ç»Ÿã€‚æˆ‘ä»¬è¦é€ä¸€æ£€æŸ¥æ¯ä¸€æ¡æ¨é€ä¸Šæ¥çš„æäº¤å†…å®¹ï¼Œçœ‹çœ‹æäº¤ä¿¡æ¯æ˜¯å¦åŒ…å«è¿™ä¹ˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åï¼Œå¦‚æœè¯¥æäº¤é‡Œä¸åŒ…å«è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä»¥éé›¶è¿”å›å€¼é€€å‡ºä»è€Œæ‹’ç»æ­¤æ¬¡æ¨é€ã€‚</p>

<p>æŠŠ <code>$newrev</code> å’Œ <code>$oldrev</code> å˜é‡çš„å€¼ä¼ ç»™ä¸€ä¸ªå«åš <code>git rev-list</code> çš„ Git plumbing å‘½ä»¤å¯ä»¥è·å–æ‰€æœ‰æäº¤å†…å®¹çš„ SHA-1 å€¼åˆ—è¡¨ã€‚<code>git rev-list</code> åŸºæœ¬ç±»ä¼¼ <code>git log</code> å‘½ä»¤ï¼Œä½†å®ƒé»˜è®¤åªè¾“å‡º SHA-1 å€¼è€Œå·²ï¼Œæ²¡æœ‰å…¶ä»–ä¿¡æ¯ã€‚æ‰€ä»¥è¦è·å–ç”± SHA å€¼è¡¨ç¤ºçš„ä»ä¸€æ¬¡æäº¤åˆ°å¦ä¸€æ¬¡æäº¤ä¹‹é—´çš„æ‰€æœ‰ SHA å€¼ï¼Œå¯ä»¥è¿è¡Œï¼š</p>

<pre><code>$ git rev-list 538c33..d14fc7
d14fc7c847ab946ec39590d87783c69b031bdfb7
9f585da4401b0a3999e84113824d15245c13f0be
234071a1be950e2a8d078e6141f5cd20c1e61ad3
dfa04c9ef3d5197182f13fb5b9b1fb7717d2222a
17716ec0f1ff5c77eff40b7fe912f9f6cfd0e475</code></pre>

<p>æˆªå–è¿™äº›è¾“å‡ºå†…å®¹ï¼Œå¾ªç¯éå†å…¶ä¸­æ¯ä¸€ä¸ª SHA å€¼ï¼Œæ‰¾å‡ºä¸ä¹‹å¯¹åº”çš„æäº¤ä¿¡æ¯ï¼Œç„¶åç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æµ‹è¯•è¯¥ä¿¡æ¯åŒ…å«çš„æ ¼å¼è¯çš„å†…å®¹ã€‚</p>

<p>ä¸‹é¢è¦æå®šå¦‚ä½•ä»æ‰€æœ‰çš„æäº¤å†…å®¹ä¸­æå–å‡ºæäº¤ä¿¡æ¯ã€‚ä½¿ç”¨å¦ä¸€ä¸ªå«åš <code>git cat-file</code> çš„ Git plumbing å·¥å…·å¯ä»¥è·å¾—åŸå§‹çš„æäº¤æ•°æ®ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬ä¹ç« äº†è§£åˆ°è¿™äº› plumbing å·¥å…·çš„ç»†èŠ‚ï¼›ç°åœ¨æš‚æ—¶å…ˆçœ‹ä¸€ä¸‹è¿™æ¡å‘½ä»¤çš„è¾“å‡ºï¼š</p>

<pre><code>$ git cat-file commit ca82a6
tree cfda3bf379e4f8dba8717dee55aab78aef7f4daf
parent 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
author Scott Chacon &lt;schacon@gmail.com&gt; 1205815931 -0700
committer Scott Chacon &lt;schacon@gmail.com&gt; 1240030591 -0700

changed the version number</code></pre>

<p>é€šè¿‡ SHA-1 å€¼è·å¾—æäº¤å†…å®¹ä¸­çš„æäº¤ä¿¡æ¯çš„ä¸€ä¸ªç®€å•åŠæ³•æ˜¯æ‰¾åˆ°æäº¤çš„ç¬¬ä¸€è¡Œï¼Œç„¶åå–ä»å®ƒå¾€åçš„æ‰€æœ‰å†…å®¹ã€‚å¯ä»¥ä½¿ç”¨ Unix ç³»ç»Ÿçš„ <code>sed</code> å‘½ä»¤æ¥å®ç°è¯¥æ•ˆæœï¼š</p>

<pre><code>$ git cat-file commit ca82a6 | sed &#39;1,/^$/d&#39;
changed the version number</code></pre>

<p>è¿™æ¡å’’è¯­ä»æ¯ä¸€ä¸ªå¾…æäº¤å†…å®¹é‡Œæå–æäº¤ä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šåœ¨æå–ä¿¡æ¯ä¸ç¬¦åˆè¦æ±‚çš„æƒ…å†µä¸‹é€€å‡ºã€‚ä¸ºäº†é€€å‡ºè„šæœ¬å’Œæ‹’ç»æ­¤æ¬¡æ¨é€ï¼Œè¿”å›ä¸€ä¸ªéé›¶å€¼ã€‚æ•´ä¸ªè„šæœ¬å¤§è‡´å¦‚ä¸‹ï¼š</p>

<pre><code>$regex = /\[ref: (\d+)\]/

# æŒ‡å®šæäº¤ä¿¡æ¯æ ¼å¼
def check_message_format
  missed_revs = `git rev-list #{$oldrev}..#{$newrev}`.split(&quot;\n&quot;)
  missed_revs.each do |rev|
    message = `git cat-file commit #{rev} | sed &#39;1,/^$/d&#39;`
    if !$regex.match(message)
      puts &quot;[POLICY] Your message is not formatted correctly&quot;
      exit 1
    end
  end
end
check_message_format</code></pre>

<p>æŠŠè¿™ä¸€æ®µæ”¾åœ¨ <code>update</code> è„šæœ¬é‡Œï¼Œæ‰€æœ‰åŒ…å«ä¸ç¬¦åˆæŒ‡å®šè§„åˆ™çš„æäº¤éƒ½ä¼šé­åˆ°æ‹’ç»ã€‚</p>

<h4 id='acl'>å®ç°åŸºäºç”¨æˆ·çš„è®¿é—®æƒé™æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ç³»ç»Ÿ</h4>

<p>å‡è®¾ä½ éœ€è¦æ·»åŠ ä¸€ä¸ªä½¿ç”¨è®¿é—®æƒé™æ§åˆ¶åˆ—è¡¨çš„æœºåˆ¶æ¥æŒ‡å®šå“ªäº›ç”¨æˆ·å¯¹é¡¹ç›®çš„å“ªäº›éƒ¨åˆ†æœ‰æ¨é€æƒé™ã€‚æŸäº›ç”¨æˆ·å…·æœ‰å…¨éƒ¨çš„è®¿é—®æƒï¼Œå…¶ä»–äººåªå¯¹æŸäº›å­ç›®å½•æˆ–è€…ç‰¹å®šçš„æ–‡ä»¶å…·æœ‰æ¨é€æƒé™ã€‚è¦æå®šè¿™ä¸€ç‚¹ï¼Œæ‰€æœ‰çš„è§„åˆ™å°†è¢«å†™å…¥ä¸€ä¸ªä½äºæœåŠ¡å™¨çš„åŸå§‹ Git ä»“åº“çš„ <code>acl</code> æ–‡ä»¶ã€‚æˆ‘ä»¬è®© <code>update</code> æŒ‚é’©æ£€é˜…è¿™äº›è§„åˆ™ï¼Œå®¡è§†æ¨é€çš„æäº¤å†…å®¹ä¸­éœ€è¦ä¿®æ”¹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œç„¶åå†³å®šæ‰§è¡Œæ¨é€çš„ç”¨æˆ·æ˜¯å¦å¯¹æ‰€æœ‰è¿™äº›æ–‡ä»¶éƒ½æœ‰æƒé™ã€‚</p>

<p>æˆ‘ä»¬é¦–å…ˆè¦åˆ›å»ºè¿™ä¸ªåˆ—è¡¨ã€‚è¿™é‡Œä½¿ç”¨çš„æ ¼å¼å’Œ CVS çš„ ACL æœºåˆ¶ååˆ†ç±»ä¼¼ï¼šå®ƒç”±è‹¥å¹²è¡Œæ„æˆï¼Œç¬¬ä¸€é¡¹å†…å®¹æ˜¯ <code>avail</code> æˆ–è€… <code>unavail</code>ï¼Œæ¥ç€æ˜¯é€—å·åˆ†éš”çš„è§„åˆ™ç”Ÿæ•ˆç”¨æˆ·åˆ—è¡¨ï¼Œæœ€åä¸€é¡¹æ˜¯è§„åˆ™ç”Ÿæ•ˆçš„ç›®å½•ï¼ˆç©ºç™½è¡¨ç¤ºå¼€æ”¾è®¿é—®ï¼‰ã€‚è¿™äº›é¡¹ç›®ç”± <code>|</code> å­—ç¬¦éš”å¼€ã€‚</p>

<p>ä¸‹ä¾‹ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šå‡ ä¸ªç®¡ç†å‘˜ï¼Œå‡ ä¸ªå¯¹ <code>doc</code> ç›®å½•å…·æœ‰æƒé™çš„æ–‡æ¡£ä½œè€…ï¼Œä»¥åŠä¸€ä¸ªå¯¹ <code>lib</code> å’Œ <code>tests</code> ç›®å½•å…·æœ‰æƒé™çš„å¼€å‘äººå‘˜ï¼Œç›¸åº”çš„ ACL æ–‡ä»¶å¦‚ä¸‹ï¼š</p>

<pre><code>avail|nickh,pjhyett,defunkt,tpw
avail|usinclair,cdickens,ebronte|doc
avail|schacon|lib
avail|schacon|tests</code></pre>

<p>é¦–å…ˆæŠŠè¿™äº›æ•°æ®è¯»å…¥ä½ ç¼–å†™çš„æ•°æ®ç»“æ„ã€‚æœ¬ä¾‹ä¸­ï¼Œä¸ºä¿æŒç®€æ´ï¼Œæˆ‘ä»¬æš‚æ—¶åªå®ç° <code>avail</code> çš„è§„åˆ™ï¼ˆè¯‘æ³¨ï¼šä¹Ÿå°±æ˜¯çœç•¥äº† <code>unavail</code> éƒ¨åˆ†ï¼‰ã€‚ä¸‹é¢è¿™ä¸ªæ–¹æ³•ç”Ÿæˆä¸€ä¸ªå…³è”æ•°ç»„ï¼Œå®ƒçš„ä¸»é”®æ˜¯ç”¨æˆ·åï¼Œå€¼æ˜¯ä¸€ä¸ªè¯¥ç”¨æˆ·æœ‰å†™æƒé™çš„æ‰€æœ‰ç›®å½•ç»„æˆçš„æ•°ç»„ï¼š</p>

<pre><code>def get_acl_access_data(acl_file)
  # read in ACL data
  acl_file = File.read(acl_file).split(&quot;\n&quot;).reject { |line| line == &#39;&#39; }
  access = {}
  acl_file.each do |line|
    avail, users, path = line.split(&#39;|&#39;)
    next unless avail == &#39;avail&#39;
    users.split(&#39;,&#39;).each do |user|
      access[user] ||= []
      access[user] &lt;&lt; path
    end
  end
  access
end</code></pre>

<p>é’ˆå¯¹ä¹‹å‰ç»™å‡ºçš„ ACL è§„åˆ™æ–‡ä»¶ï¼Œè¿™ä¸ª <code>get_acl_access_data</code> æ–¹æ³•è¿”å›çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>

<pre><code>{&quot;defunkt&quot;=&gt;[nil],
 &quot;tpw&quot;=&gt;[nil],
 &quot;nickh&quot;=&gt;[nil],
 &quot;pjhyett&quot;=&gt;[nil],
 &quot;schacon&quot;=&gt;[&quot;lib&quot;, &quot;tests&quot;],
 &quot;cdickens&quot;=&gt;[&quot;doc&quot;],
 &quot;usinclair&quot;=&gt;[&quot;doc&quot;],
 &quot;ebronte&quot;=&gt;[&quot;doc&quot;]}</code></pre>

<p>æå®šäº†ç”¨æˆ·æƒé™çš„æ•°æ®ï¼Œä¸‹é¢éœ€è¦æ‰¾å‡ºå“ªäº›ä½ç½®å°†è¦è¢«æäº¤çš„å†…å®¹ä¿®æ”¹ï¼Œä»è€Œç¡®ä¿è¯•å›¾æ¨é€çš„ç”¨æˆ·å¯¹è¿™äº›ä½ç½®æœ‰å…¨éƒ¨çš„æƒé™ã€‚</p>

<p>ä½¿ç”¨ <code>git log</code> çš„ <code>--name-only</code> é€‰é¡¹ï¼ˆåœ¨ç¬¬äºŒç« é‡Œç®€å•çš„æè¿‡ï¼‰æˆ‘ä»¬å¯ä»¥è½»è€Œæ˜“ä¸¾çš„æ‰¾å‡ºä¸€æ¬¡æäº¤é‡Œä¿®æ”¹çš„æ–‡ä»¶ï¼š</p>

<pre><code>$ git log -1 --name-only --pretty=format:&#39;&#39; 9f585d

README
lib/test.rb</code></pre>

<p>ä½¿ç”¨ <code>get_acl_access_data</code> è¿”å›çš„ ACL ç»“æ„æ¥ä¸€ä¸€æ ¸å¯¹æ¯ä¸€æ¬¡æäº¤ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå°±èƒ½æ‰¾å‡ºè¯¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ¨é€æ‰€æœ‰çš„æäº¤å†…å®¹:</p>

<pre><code># ä»…å…è®¸ç‰¹å®šç”¨æˆ·ä¿®æ”¹é¡¹ç›®ä¸­çš„ç‰¹å®šå­ç›®å½•
def check_directory_perms
  access = get_acl_access_data(&#39;acl&#39;)

  # æ£€æŸ¥æ˜¯å¦æœ‰äººåœ¨å‘ä»–æ²¡æœ‰æƒé™çš„åœ°æ–¹æ¨é€å†…å®¹
  new_commits = `git rev-list #{$oldrev}..#{$newrev}`.split(&quot;\n&quot;)
  new_commits.each do |rev|
    files_modified = `git log -1 --name-only --pretty=format:&#39;&#39; #{rev}`.split(&quot;\n&quot;)
    files_modified.each do |path|
      next if path.size == 0
      has_file_access = false
      access[$user].each do |access_path|
        if !access_path  # ç”¨æˆ·æ‹¥æœ‰å®Œå…¨è®¿é—®æƒé™
          || (path.index(access_path) == 0) # æˆ–è€…å¯¹æ­¤ä½ç½®æœ‰è®¿é—®æƒé™
          has_file_access = true 
        end
      end
      if !has_file_access
        puts &quot;[POLICY] You do not have access to push to #{path}&quot;
        exit 1
      end
    end
  end  
end

check_directory_perms</code></pre>

<p>ä»¥ä¸Šçš„å¤§éƒ¨åˆ†å†…å®¹åº”è¯¥éƒ½æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚é€šè¿‡ <code>git rev-list</code> è·å–æ¨é€åˆ°æœåŠ¡å™¨å†…å®¹çš„æäº¤åˆ—è¡¨ã€‚ç„¶åï¼Œé’ˆå¯¹å…¶ä¸­æ¯ä¸€é¡¹ï¼Œæ‰¾å‡ºå®ƒè¯•å›¾ä¿®æ”¹çš„æ–‡ä»¶ç„¶åç¡®ä¿æ‰§è¡Œæ¨é€çš„ç”¨æˆ·å¯¹è¿™äº›æ–‡ä»¶å…·æœ‰æƒé™ã€‚ä¸€ä¸ªä¸å¤ªå®¹æ˜“ç†è§£çš„ Ruby æŠ€å·§çŸ³ <code>path.index(access_path) ==0</code> è¿™å¥ï¼Œå®ƒçš„è¿”å›çœŸå€¼å¦‚æœè·¯å¾„ä»¥ <code>access_path</code> å¼€å¤´â€”â€”è¿™æ˜¯ä¸ºäº†ç¡®ä¿ <code>access_path  </code> å¹¶ä¸æ˜¯åªåœ¨å…è®¸çš„è·¯å¾„ä¹‹ä¸€ï¼Œè€Œæ˜¯æ‰€æœ‰å‡†è®¸å…¨é€‰çš„ç›®å½•éƒ½åœ¨è¯¥ç›®å½•ä¹‹ä¸‹ã€‚</p>

<p>ç°åœ¨ä½ çš„ç”¨æˆ·æ²¡æ³•æ¨é€å¸¦æœ‰ä¸æ­£ç¡®çš„æäº¤ä¿¡æ¯çš„å†…å®¹ï¼Œä¹Ÿä¸èƒ½åœ¨å‡†è®¸ä»–ä»¬è®¿é—®èŒƒå›´ä¹‹å¤–çš„ä½ç½®åšå‡ºä¿®æ”¹ã€‚</p>

<h4 id='_fastforward_'>åªå…è®¸ Fast-Forward ç±»å‹çš„æ¨é€</h4>

<p>å‰©ä¸‹çš„æœ€åä¸€é¡¹ä»»åŠ¡æ˜¯æŒ‡å®šåªæ¥å— fast-forward çš„æ¨é€ã€‚åœ¨ Git 1.6 æˆ–è€…æ›´æ–°ç‰ˆæœ¬é‡Œï¼Œåªéœ€è¦è®¾å®š <code>receive.denyDeletes</code> å’Œ <code>receive.denyNonFastForwards</code> é€‰é¡¹å°±å¯ä»¥äº†ã€‚ä½†æ˜¯é€šè¿‡æŒ‚é’©çš„å®ç°å¯ä»¥åœ¨æ—§ç‰ˆæœ¬çš„ Git ä¸Šå·¥ä½œï¼Œå¹¶ä¸”é€šè¿‡ä¸€å®šçš„ä¿®æ”¹å®ƒå®ƒå¯ä»¥åšåˆ°åªé’ˆå¯¹æŸäº›ç”¨æˆ·æ‰§è¡Œï¼Œæˆ–è€…æ›´å¤šä»¥åå¯èƒ½ç”¨çš„åˆ°çš„è§„åˆ™ã€‚</p>

<p>æ£€æŸ¥è¿™ä¸€é¡¹çš„é€»è¾‘æ˜¯çœ‹çœ‹æäº¤é‡Œæ˜¯å¦åŒ…å«ä»æ—§ç‰ˆæœ¬é‡Œèƒ½æ‰¾åˆ°ä½†åœ¨æ–°ç‰ˆæœ¬é‡Œå´æ‰¾ä¸åˆ°çš„å†…å®¹ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£è¿™æ˜¯ä¸€æ¬¡çº¯ fast-forward çš„æ¨é€ï¼›å¦‚æœæœ‰ï¼Œé‚£æˆ‘ä»¬æ‹’ç»æ­¤æ¬¡æ¨é€ï¼š</p>

<pre><code># åªå…è®¸çº¯ fast-forward æ¨é€
def check_fast_forward
  missed_refs = `git rev-list #{$newrev}..#{$oldrev}`
  missed_ref_count = missed_refs.split(&quot;\n&quot;).size
  if missed_ref_count &gt; 0
    puts &quot;[POLICY] Cannot push a non fast-forward reference&quot;
    exit 1
  end
end

check_fast_forward</code></pre>

<p>ä¸€åˆ‡éƒ½è®¾å®šå¥½äº†ã€‚å¦‚æœç°åœ¨è¿è¡Œ <code>chmod u+x .git/hooks/update</code> â€”â€” ä¿®æ”¹åŒ…å«ä»¥ä¸Šå†…å®¹æ–‡ä»¶çš„æƒé™ï¼Œç„¶åå°è¯•æ¨é€ä¸€ä¸ªåŒ…å«é fast-forward ç±»å‹çš„ç´¢å¼•ï¼Œä¼šå¾—åˆ°ä¸€ä¸‹æç¤ºï¼š</p>

<pre><code>$ git push -f origin master
Counting objects: 5, done.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 323 bytes, done.
Total 3 (delta 1), reused 0 (delta 0)
Unpacking objects: 100% (3/3), done.
Enforcing Policies... 
(refs/heads/master) (8338c5) (c5b616)
[POLICY] Cannot push a non-fast-forward reference
error: hooks/update exited with error code 1
error: hook declined to update refs/heads/master
To git@gitserver:project.git
 ! [remote rejected] master -&gt; master (hook declined)
error: failed to push some refs to &#39;git@gitserver:project.git&#39;</code></pre>

<p>è¿™é‡Œæœ‰å‡ ä¸ªæœ‰è¶£çš„ä¿¡æ¯ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æŒ‚é’©è¿è¡Œçš„èµ·ç‚¹ï¼š</p>

<pre><code>Enforcing Policies... 
(refs/heads/master) (fb8c72) (c56860)</code></pre>

<p>æ³¨æ„è¿™æ˜¯ä» update è„šæœ¬å¼€å¤´è¾“å‡ºåˆ°æ ‡å‡†ä½ è¾“å‡ºçš„ã€‚æ‰€æœ‰ä»è„šæœ¬è¾“å‡ºçš„æç¤ºéƒ½ä¼šå‘é€åˆ°å®¢æˆ·ç«¯ï¼Œè¿™ç‚¹å¾ˆé‡è¦ã€‚</p>

<p>ä¸‹ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„éƒ¨åˆ†æ˜¯é”™è¯¯ä¿¡æ¯ã€‚</p>

<pre><code>[POLICY] Cannot push a non fast-forward reference
error: hooks/update exited with error code 1
error: hook declined to update refs/heads/master</code></pre>

<p>ç¬¬ä¸€è¡Œæ˜¯æˆ‘ä»¬çš„è„šæœ¬è¾“å‡ºçš„ï¼Œåœ¨å¾€ä¸‹æ˜¯ Git åœ¨å‘Šè¯‰æˆ‘ä»¬ update è„šæœ¬é€€å‡ºæ—¶è¿”å›äº†éé›¶å€¼å› è€Œæ¨é€é­åˆ°äº†æ‹’ç»ã€‚æœ€åä¸€ç‚¹ï¼š</p>

<pre><code>To git@gitserver:project.git
 ! [remote rejected] master -&gt; master (hook declined)
error: failed to push some refs to &#39;git@gitserver:project.git&#39;</code></pre>

<p>æˆ‘ä»¬å°†ä¸ºæ¯ä¸€ä¸ªè¢«æŒ‚é’©æ‹’ä¹‹é—¨å¤–çš„ç´¢å¼•å—åˆ°ä¸€æ¡è¿œç¨‹ä¿¡æ¯ï¼Œè§£é‡Šå®ƒè¢«æ‹’ç»æ˜¯å› ä¸ºä¸€ä¸ªæŒ‚é’©çš„åŸå› ã€‚</p>

<p>è€Œä¸”ï¼Œå¦‚æœé‚£ä¸ª ref å­—ç¬¦ä¸²æ²¡æœ‰åŒ…å«åœ¨ä»»ä½•çš„æäº¤é‡Œï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å‰é¢è„šæœ¬é‡Œè¾“å‡ºçš„é”™è¯¯ä¿¡æ¯ï¼š</p>

<pre><code>[POLICY] Your message is not formatted correctly</code></pre>

<p>åˆæˆ–è€…æŸäººæƒ³ä¿®æ”¹ä¸€ä¸ªè‡ªå·±ä¸å…·å¤‡æƒé™çš„æ–‡ä»¶ç„¶åæ¨é€äº†ä¸€ä¸ªåŒ…å«å®ƒçš„æäº¤ï¼Œä»–å°†çœ‹åˆ°ç±»ä¼¼çš„æç¤ºã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªæ–‡æ¡£ä½œè€…å°è¯•æ¨é€ä¸€ä¸ªä¿®æ”¹åˆ° <code>lib</code> ç›®å½•çš„æäº¤ï¼Œä»–ä¼šçœ‹åˆ°</p>

<pre><code>[POLICY] You do not have access to push to lib/test.rb</code></pre>

<p>å…¨åœ¨è¿™äº†ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œåªè¦ <code>update</code> è„šæœ¬å­˜åœ¨å¹¶ä¸”å¯æ‰§è¡Œï¼Œæˆ‘ä»¬çš„ä»“åº“æ°¸è¿œéƒ½ä¸ä¼šé­åˆ°å›è½¬æˆ–è€…åŒ…å«ä¸ç¬¦åˆè¦æ±‚ä¿¡æ¯çš„æäº¤å†…å®¹ï¼Œå¹¶ä¸”ç”¨æˆ·éƒ½è¢«é”åœ¨äº†æ²™ç®±é‡Œé¢ã€‚</p>

<h3 id='id388'>å®¢æˆ·ç«¯æŒ‚é’©</h3>

<p>è¿™ç§æ‰‹æ®µçš„ç¼ºç‚¹åœ¨äºç”¨æˆ·æ¨é€å†…å®¹é­åˆ°æ‹’ç»åå‡ ä¹æ— æ³•é¿å…çš„æŠ±æ€¨ã€‚è¾›è¾›è‹¦è‹¦å†™æˆçš„ä»£ç åœ¨æœ€åæ—¶åˆ»æƒ¨é­æ‹’ç»æ˜¯ååˆ†æ‚²å‰§åˆ‡å…·è¿·æƒ‘æ€§çš„ï¼›æ›´å¯æ€œçš„æ˜¯ä»–ä»¬ä¸å¾—ä¸ä¿®æ”¹æäº¤å†å²æ¥è§£å†³é—®é¢˜ï¼Œè¿™æ€ä¹ˆä¹Ÿç®—ä¸ä¸Šç‹é“ã€‚</p>

<p>é€ƒç¦»è¿™ç§ä¸¤éš¾å¢ƒåœ°çš„æ³•å®æ˜¯ç»™ç”¨æˆ·ä¸€äº›å®¢æˆ·ç«¯çš„æŒ‚é’©ï¼Œåœ¨ä»–ä»¬ä½œå‡ºå¯èƒ½æ‚²å‰§çš„äº‹æƒ…çš„æ—¶å€™ç»™ä»¥è­¦å‘Šã€‚ç„¶åå‘¢ï¼Œç”¨æˆ·ä»¬å°±èƒ½åœ¨æäº¤&#8211;é—®é¢˜å˜å¾—æ›´éš¾ä¿®æ­£ä¹‹å‰è§£é™¤éšæ‚£ã€‚ç”±äºæŒ‚é’©æœ¬èº«ä¸è·Ÿéšå…‹éš†çš„é¡¹ç›®å‰¯æœ¬åˆ†å‘ï¼Œæ‰€ä»¥å¿…é¡»é€šè¿‡å…¶ä»–é€”å¾„æŠŠè¿™äº›æŒ‚é’©åˆ†å‘åˆ°ç”¨æˆ·çš„ .git/hooks ç›®å½•å¹¶è®¾ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚è™½ç„¶å¯ä»¥åœ¨ç›¸åŒæˆ–å•ç‹¬çš„é¡¹ç›®å†… å®¹é‡ŒåŠ å…¥å¹¶åˆ†å‘å®ƒä»¬ï¼Œå…¨è‡ªåŠ¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸å­˜åœ¨çš„ã€‚</p>

<p>é¦–å…ˆï¼Œä½ åº”è¯¥åœ¨æ¯æ¬¡æäº¤å‰æ ¸æŸ¥ä½ çš„æäº¤æ³¨é‡Šä¿¡æ¯ï¼Œè¿™æ ·ä½ æ‰èƒ½ç¡®ä¿æœåŠ¡å™¨ä¸ä¼šå› ä¸ºä¸åˆæ¡ä»¶çš„æäº¤æ³¨é‡Šä¿¡æ¯è€Œæ‹’ç»ä½ çš„æ›´æ”¹ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä½ å¯ä»¥å¢åŠ &#8217;commit-msg&#8217;æŒ‚é’©ã€‚å¦‚æœä½ ä½¿ç”¨è¯¥æŒ‚é’©æ¥é˜…è¯»ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™gitçš„æäº¤æ³¨é‡Šä¿¡æ¯ï¼Œå¹¶ä¸”ä¸è§„å®šçš„æ¨¡å¼ä½œå¯¹æ¯”ï¼Œä½ å°±å¯ä»¥ä½¿gitåœ¨æäº¤æ³¨é‡Šä¿¡æ¯ä¸ç¬¦åˆæ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œæ‹’ç»æ‰§è¡Œæäº¤ã€‚</p>

<pre><code>#!/usr/bin/env ruby
message_file = ARGV[0]
message = File.read(message_file)

$regex = /\[ref: (\d+)\]/

if !$regex.match(message)
  puts &quot;[POLICY] Your message is not formatted correctly&quot;
  exit 1
end</code></pre>

<p>å¦‚æœè¿™ä¸ªè„šæœ¬æ”¾åœ¨è¿™ä¸ªä½ç½® (<code>.git/hooks/commit-msg</code>) å¹¶ä¸”æ˜¯å¯æ‰§è¡Œçš„, å¹¶ä¸”ä½ çš„æäº¤æ³¨é‡Šä¿¡æ¯ä¸æ˜¯ç¬¦åˆè¦æ±‚çš„ï¼Œä½ ä¼šçœ‹åˆ°ï¼š</p>

<pre><code>$ git commit -am &#39;test&#39;
[POLICY] Your message is not formatted correctly</code></pre>

<p>åœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼Œæäº¤æ²¡æœ‰æˆåŠŸã€‚ç„¶è€Œå¦‚æœä½ çš„æäº¤æ³¨é‡Šä¿¡æ¯æ˜¯ç¬¦åˆè¦æ±‚çš„ï¼Œgitä¼šå…è®¸ä½ æäº¤ï¼š</p>

<pre><code>$ git commit -am &#39;test [ref: 132]&#39;
[master e05c914] test [ref: 132]
 1 files changed, 1 insertions(+), 0 deletions(-)</code></pre>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦ä¿è¯æ²¡æœ‰ä¿®æ”¹åˆ° ACL å…è®¸èŒƒå›´ä¹‹å¤–çš„æ–‡ä»¶ã€‚åŠ å…¥ä½ çš„ .git ç›®å½•é‡Œæœ‰å‰é¢ä½¿ç”¨è¿‡çš„ ACL æ–‡ä»¶ï¼Œé‚£ä¹ˆä»¥ä¸‹çš„ pre-commit è„šæœ¬å°†æŠŠé‡Œé¢çš„è§„å®šæ‰§è¡Œèµ·æ¥ï¼š</p>

<pre><code>#!/usr/bin/env ruby

$user    = ENV[&#39;USER&#39;]

# [ insert acl_access_data method from above ]

# åªå…è®¸ç‰¹å®šç”¨æˆ·ä¿®æ”¹é¡¹ç›®é‡ç‰¹å®šå­ç›®å½•çš„å†…å®¹
def check_directory_perms
  access = get_acl_access_data(&#39;.git/acl&#39;)

  files_modified = `git diff-index --cached --name-only HEAD`.split(&quot;\n&quot;)
  files_modified.each do |path|
    next if path.size == 0
    has_file_access = false
    access[$user].each do |access_path|
    if !access_path || (path.index(access_path) == 0)
      has_file_access = true
    end
    if !has_file_access
      puts &quot;[POLICY] You do not have access to push to #{path}&quot;
      exit 1
    end
  end
end

check_directory_perms</code></pre>

<p>è¿™å’ŒæœåŠ¡ç«¯çš„è„šæœ¬å‡ ä¹ä¸€æ ·ï¼Œé™¤äº†ä¸¤ä¸ªé‡è¦åŒºåˆ«ã€‚ç¬¬ä¸€ï¼ŒACL æ–‡ä»¶çš„ä½ç½®ä¸åŒï¼Œå› ä¸ºè¿™ä¸ªè„šæœ¬åœ¨å½“å‰å·¥ä½œç›®å½•è¿è¡Œï¼Œè€Œé Git ç›®å½•ã€‚ACL æ–‡ä»¶çš„ç›®å½•å¿…é¡»ä»</p>

<pre><code>access = get_acl_access_data(&#39;acl&#39;)</code></pre>

<p>ä¿®æ”¹æˆï¼š</p>

<pre><code>access = get_acl_access_data(&#39;.git/acl&#39;)</code></pre>

<p>å¦ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯è·å–è¢«ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨çš„æ–¹å¼ã€‚åœ¨æœåŠ¡ç«¯çš„æ—¶å€™ä½¿ç”¨äº†æŸ¥çœ‹æäº¤çºªå½•çš„æ–¹å¼ï¼Œå¯æ˜¯ç›®å‰çš„æäº¤éƒ½è¿˜æ²¡è¢«è®°å½•ä¸‹æ¥å‘¢ï¼Œæ‰€ä»¥è¿™ä¸ªåˆ—è¡¨åªèƒ½ä»æš‚å­˜åŒºåŸŸè·å–ã€‚å’ŒåŸæ¥çš„</p>

<pre><code>files_modified = `git log -1 --name-only --pretty=format:&#39;&#39; #{ref}`</code></pre>

<p>ä¸åŒï¼Œç°åœ¨è¦ç”¨</p>

<pre><code>files_modified = `git diff-index --cached --name-only HEAD`</code></pre>

<p>ä¸åŒçš„å°±åªæœ‰è¿™ä¸¤ç‚¹â€”â€”é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥è„šæœ¬å®Œå…¨ç›¸åŒã€‚ä¸€ä¸ªå°é™·é˜±åœ¨äºå®ƒå‡è®¾åœ¨æœ¬åœ°è¿è¡Œçš„è´¦æˆ·å’Œæ¨é€åˆ°è¿œç¨‹æœåŠ¡ç«¯çš„ç›¸åŒã€‚å¦‚æœè¿™äºŒè€…ä¸ä¸€æ ·ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹ <code>$user</code> å˜é‡ã€‚</p>

<p>æœ€åä¸€é¡¹ä»»åŠ¡æ˜¯æ£€æŸ¥ç¡®è®¤æ¨é€å†…å®¹ä¸­ä¸åŒ…å«é fast-forward ç±»å‹çš„ç´¢å¼•ï¼Œä¸è¿‡è¿™ä¸ªéœ€æ±‚æ¯”è¾ƒå°‘è§ã€‚è¦æ‰¾å‡ºä¸€ä¸ªé fast-forward ç±»å‹çš„ç´¢å¼•ï¼Œè¦ä¹ˆè¡åˆè¶…è¿‡æŸä¸ªå·²ç»æ¨é€è¿‡çš„æäº¤ï¼Œè¦ä¹ˆä»æœ¬åœ°ä¸åŒåˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ç›¸åŒçš„åˆ†æ”¯ä¸Šã€‚</p>

<p>æ—¢ç„¶æœåŠ¡å™¨å°†ç»™å‡ºæ— æ³•æ¨é€é fast-forward å†…å®¹çš„æç¤ºï¼Œè€Œä¸”ä¸Šé¢çš„æŒ‚é’©ä¹Ÿèƒ½é˜»æ­¢å¼ºåˆ¶çš„æ¨é€ï¼Œå”¯ä¸€å‰©ä¸‹çš„æ½œåœ¨é—®é¢˜å°±æ˜¯è¡åˆä¸€æ¬¡å·²ç»æ¨é€è¿‡çš„æäº¤å†…å®¹ã€‚</p>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ£€æŸ¥è¿™ä¸ªé—®é¢˜çš„ pre-rabase è„šæœ¬çš„ä¾‹å­ã€‚å®ƒè·å–ä¸€ä¸ªæ‰€æœ‰å³å°†é‡å†™çš„æäº¤å†…å®¹çš„åˆ—è¡¨ï¼Œç„¶åæ£€æŸ¥å®ƒä»¬æ˜¯å¦åœ¨è¿œç¨‹çš„ç´¢å¼•é‡Œå·²ç»å­˜åœ¨ã€‚ä¸€æ—¦å‘ç°æŸä¸ªæäº¤å¯ä»¥ä»è¿œç¨‹ç´¢å¼•é‡Œè¡å˜è¿‡æ¥ï¼Œå®ƒå°±æ”¾å¼ƒè¡åˆæ“ä½œï¼š</p>

<pre><code>#!/usr/bin/env ruby

base_branch = ARGV[0]
if ARGV[1]
  topic_branch = ARGV[1]
else
  topic_branch = &quot;HEAD&quot;
end

target_shas = `git rev-list #{base_branch}..#{topic_branch}`.split(&quot;\n&quot;)
remote_refs = `git branch -r`.split(&quot;\n&quot;).map { |r| r.strip }

target_shas.each do |sha|
  remote_refs.each do |remote_ref|
    shas_pushed = `git rev-list ^#{sha}^@ refs/remotes/#{remote_ref}`
    if shas_pushed.split(â€œ\nâ€).include?(sha)
      puts &quot;[POLICY] Commit #{sha} has already been pushed to #{remote_ref}&quot;
      exit 1
    end
  end
end</code></pre>

<p>è¿™ä¸ªè„šæœ¬åˆ©ç”¨äº†ä¸€ä¸ªç¬¬å…­ç« â€œä¿®è®¢ç‰ˆæœ¬é€‰æ‹©â€ä¸€èŠ‚ä¸­ä¸æ›¾æåˆ°çš„è¯­æ³•ã€‚é€šè¿‡è¿™ä¸€å¥å¯ä»¥è·å¾—ä¸€ä¸ªæ‰€æœ‰å·²ç»å®Œæˆæ¨é€çš„æäº¤çš„åˆ—è¡¨ï¼š</p>

<pre><code>git rev-list ^#{sha}^@ refs/remotes/#{remote_ref}</code></pre>

<p><code>SHA^@</code> è¯­æ³•è§£æè¯¥æ¬¡æäº¤çš„æ‰€æœ‰ç¥–å…ˆã€‚è¿™é‡Œæˆ‘ä»¬ä»æ£€æŸ¥è¿œç¨‹æœ€åä¸€æ¬¡æäº¤èƒ½å¤Ÿè¡å˜è·å¾—ä½†ä»æ‰€æœ‰æˆ‘ä»¬å°è¯•æ¨é€çš„æäº¤çš„ SHA å€¼ç¥–å…ˆæ— æ³•è¡å˜è·å¾—çš„æäº¤å†…å®¹â€”â€”ä¹Ÿå°±æ˜¯ fast-forward çš„å†…å®¹ã€‚</p>

<p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„ç¡¬ä¼¤åœ¨äºå®ƒæœ‰å¯èƒ½å¾ˆæ…¢è€Œä¸”å¸¸å¸¸æ²¡æœ‰å¿…è¦â€”â€”åªè¦ä¸ç”¨ <code>-f</code> æ¥å¼ºåˆ¶æ¨é€ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨ç»™å‡ºè­¦å‘Šå¹¶ä¸”æ‹’ç»æ¨é€å†…å®¹ã€‚ç„¶è€Œï¼Œè¿™æ˜¯ä¸ªä¸é”™çš„ç»ƒä¹ è€Œä¸”ç†è®ºä¸Šèƒ½å¸®åŠ©ç”¨æˆ·é¿å…ä¸€æ¬¡å°†æ¥ä¸å¾—ä¸æŠ˜å›æ¥ä¿®æ”¹çš„è¡åˆæ“ä½œã€‚</p>

<div id='nav'>
<a href="ch7-3.html" tppabs="http://progit.org/book/zh/ch7-3.html">prev</a> | <a href="ch7-5.html" tppabs="http://progit.org/book/zh/ch7-5.html">next</a>
</div>
        <div class='clearfix'></div>
      </div>
    </div>
    <div id='footer'>
      Book translated into 
        <a href="javascript:if(confirm('http://progit.org/book/de  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/de'" tppabs="http://progit.org/book/de">German</a>, 
        <a href="javascript:if(confirm('http://progit.org/book/zh  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/zh'" tppabs="http://progit.org/book/zh">Chinese</a>, 
        <a href="javascript:if(confirm('http://progit.org/book/ja  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/ja'" tppabs="http://progit.org/book/ja">Japanese</a> and 
        <a href="javascript:if(confirm('http://progit.org/book/nl  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/nl'" tppabs="http://progit.org/book/nl">Dutch</a>.<br/>
      Partial translations available in 
        <a href="javascript:if(confirm('http://progit.org/book/ar  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/ar'" tppabs="http://progit.org/book/ar">Arabic</a>,
        <a href="javascript:if(confirm('http://progit.org/book/cs  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/cs'" tppabs="http://progit.org/book/cs">Czech</a>,
        <a href="javascript:if(confirm('http://progit.org/book/es  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/es'" tppabs="http://progit.org/book/es">Spanish</a>,
        <a href="javascript:if(confirm('http://progit.org/book/fr  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/fr'" tppabs="http://progit.org/book/fr">French</a>,
        <a href="javascript:if(confirm('http://progit.org/book/id  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/id'" tppabs="http://progit.org/book/id">Indonesian</a>,
        <a href="javascript:if(confirm('http://progit.org/book/it  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/it'" tppabs="http://progit.org/book/it">Italian</a>,
        <a href="javascript:if(confirm('http://progit.org/book/mk  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/mk'" tppabs="http://progit.org/book/mk">Macedonian</a>,
        <a href="javascript:if(confirm('http://progit.org/book/pl  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/pl'" tppabs="http://progit.org/book/pl">Polish</a>,
        <a href="javascript:if(confirm('http://progit.org/book/th  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/th'" tppabs="http://progit.org/book/th">Thai</a> and
        <a href="javascript:if(confirm('http://progit.org/book/ru  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://progit.org/book/ru'" tppabs="http://progit.org/book/ru">Russian</a>
        .<br/>
      All content under <a href="javascript:if(confirm('http://creativecommons.org/licenses/by-nc-sa/3.0/us/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://creativecommons.org/licenses/by-nc-sa/3.0/us/'" tppabs="http://creativecommons.org/licenses/by-nc-sa/3.0/us/">Creative Commons Attribution-Non Commercial-Share Alike 3.0 license</a>.
      <br/>Theme and code by <a href="javascript:if(confirm('http://github.com/mbleigh  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://github.com/mbleigh'" tppabs="http://github.com/mbleigh">Michael Bleigh</a>. Hosted by <a href="javascript:if(confirm('http://github.com/progit/progit.github.com/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://github.com/progit/progit.github.com/'" tppabs="http://github.com/progit/progit.github.com/" target='_blank'>GitHub</a> and powered by <a href="javascript:if(confirm('http://github.com/mojombo/jekyll  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://github.com/mojombo/jekyll'" tppabs="http://github.com/mojombo/jekyll">Jekyll</a>.
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www./");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-82337-15");
    pageTracker._trackPageview();
    } catch(err) {}</script>
  </body>
</html>
